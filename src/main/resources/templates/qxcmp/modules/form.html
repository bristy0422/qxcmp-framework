<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<body>
<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.AbstractForm"*/-->
<th:block th:fragment="form(component)">
    <th:block th:if="${component.header ne null}">
        <div th:replace="~{qxcmp/globals/components :: component(${component.header})}"></div>
    </th:block>
    <form th:object="${__${component.object}__}"
          th:id="${component.id}" th:name="${component.name} ?: _" th:class="${component.getClassName()}"
          th:action="@{${component.action}} ?: _" th:method="${component.method ?: _}" th:enctype="${component.enctype}"
          th:autocomplete="not ${component.disableAutoComplete}" th:target="${component.target} ?: _">
        <th:block th:if="${component.infoMessage ne null}">
            <div th:replace="~{qxcmp/globals/components :: component(${component.infoMessage})}"></div>
        </th:block>
        <th:block th:if="${component.successMessage ne null}">
            <div th:replace="~{qxcmp/globals/components :: component(${component.successMessage})}"></div>
        </th:block>
        <th:block th:if="${component.warningMessage ne null}">
            <div th:replace="~{qxcmp/globals/components :: component(${component.warningMessage})}"></div>
        </th:block>
        <th:block th:if="${component.errorMessage ne null}">
            <div th:replace="~{qxcmp/globals/components :: component(${component.errorMessage})}"></div>
        </th:block>
        <th:block th:each="section : ${component.sections}">
            <div th:replace="~{:: section(${component}, ${section})}"></div>
        </th:block>
        <div class="submit section">
            <div th:replace="~{qxcmp/globals/components :: component(${component.submitButton})}"></div>
        </div>

        <script th:inline="javascript">
            $(document).ready(function () {
                var id = /*[[|#${component.id}|]]*/ "";
                var button = $(id).find(".submit.section button");

                $(id).submit(function () {
                    $(button).addClass("disabled loading");
                });
            });
        </script>
    </form>
</th:block>

<!--/*@thymesVar id="form" type="com.qxcmp.framework.web.view.modules.form.AbstractForm"*/-->
<!--/*@thymesVar id="section" type="com.qxcmp.framework.web.view.modules.form.AbstractFormSection"*/-->
<div th:fragment="section(form, section)" class="section">
    <div th:if="${#lists.size(form.sections) gt 1}" class="ui dividing small header" th:utext="${section.name}"></div>
    <th:block th:each="field : ${section.fields}">
        <div th:replace="~{qxcmp/globals/components :: component(${field})}"></div>
    </th:block>
</div>

<label th:fragment="field-label(component)">
    [[${component.label}]] <i th:if="not ${#strings.isEmpty(component.tooltip)}"
                              class="help circle outline link icon" th:attr="data-content=${component.tooltip}"></i>
</label>

<th:block th:fragment="field-common-script(component)">
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "";
            var helpIcon = $(id).find(".help.icon");
            $(helpIcon).popup({position: 'top center'});
        });
    </script>
</th:block>

<th:block th:fragment="field-text-script(component)">
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "";
            var input = $(id).find("input,textarea");
            var span = $(input).next("span");
            var maxLength = $(span).attr("data-max-length");

            span.text($(input).val().length + "/" + maxLength);

            $(input).focus(function () {
                span.css("display", "inherit")
            });

            $(input).blur(function () {
                span.css("display", "none")
            });

            $(input).on('keyup', function () {
                var count = $(this).val().length;
                span.text(count + "/" + maxLength);
            });
        });
    </script>
</th:block>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.HiddenField"*/-->
<th:block th:fragment="field-hidden(component)">
    <input th:field="*{__${component.name}__}" type="hidden"/>
</th:block>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.TextInputField"*/-->
<div th:fragment="field-text-input(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <input th:field="*{__${component.name}__}" th:placeholder="${component.placeholder}"
           th:maxlength="${(component.maxLength gt 0) ? component.maxLength : _}"
           th:autocomplete="not ${component.disableAutoComplete}" th:required="${component.required}"
           th:autofocus="${component.autoFocus}" th:readonly="${component.readOnly}"/>
    <span class="counter" style="display: none" th:attr="data-max-length=${component.maxLength}"></span>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:replace="~{:: field-text-script(${component})}"></script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.TextInputField"*/-->
<div th:fragment="field-password(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <input th:field="*{__${component.name}__}" type="password" th:placeholder="${component.placeholder}"
           th:maxlength="${(component.maxLength gt 0) ? component.maxLength : _}"
           th:autocomplete="not ${component.disableAutoComplete}" th:required="${component.required}"
           th:autofocus="${component.autoFocus}" th:readonly="${component.readOnly}"/>
    <span class="counter" style="display: none" th:attr="data-max-length=${component.maxLength}"></span>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:replace="~{:: field-text-script(${component})}"></script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.EmailField"*/-->
<div th:fragment="field-email(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <input th:field="*{__${component.name}__}" type="email" th:placeholder="${component.placeholder}"
           th:maxlength="${(component.maxLength gt 0) ? component.maxLength : _}"
           th:autocomplete="not ${component.disableAutoComplete}" th:required="${component.required}"
           th:autofocus="${component.autoFocus}" th:readonly="${component.readOnly}"/>
    <!--<div class="component">-->
    <!--<div class="ui search selection fluid dropdown">-->
    <!--<input th:field="*{__${component.name}__}" type="hidden"/>-->
    <!--<i class="dropdown icon"></i>-->
    <!--<div class="default text" th:utext="${component.placeholder}"></div>-->
    <!--<div class="menu">-->
    <!--<div th:each="suffix : ${component.suffixList}" class="item" th:attr="data-suffix=|@${suffix}|"-->
    <!--th:utext="|@${suffix}|"></div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:replace="~{:: field-text-script(${component})}"></script>
    <!--<script th:inline="javascript">-->
    <!--$(document).ready(function () {-->
    <!--var id = /*[[|#${component.id}|]]*/ "";-->
    <!--var dropdown = $(id).find(".component .ui.dropdown");-->
    <!--$(dropdown).dropdown();-->
    <!--var searchInput = $(dropdown).find("input.search");-->
    <!--$(searchInput).on("keyup", function () {-->
    <!--var value = $(this).val().split("@")[0];-->
    <!--var extraVale = $(this).val().split("@")[1];-->
    <!--$.each($(dropdown).find(".menu .item"), function () {-->
    <!--$(this).text(value + $(this).attr("data-suffix"));-->
    <!--});-->
    <!--$(searchInput).click();-->
    <!--});-->
    <!--});-->
    <!--</script>-->
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.PhoneField"*/-->
<div th:fragment="field-phone(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <input th:field="*{__${component.name}__}" type="text" th:placeholder="${component.placeholder}"
           th:maxlength="${(component.maxLength gt 0) ? component.maxLength : _}"
           th:autocomplete="not ${component.disableAutoComplete}" th:required="${component.required}"
           th:autofocus="${component.autoFocus}" th:readonly="${component.readOnly}"/>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:replace="~{:: field-text-script(${component})}"></script>
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "";
            var input = $(id).find("input");

            $(input).on("change", function () {
                var phoneNumber = $(input).val();

                if (!(/^1[34578]\d{9}$/.test(phoneNumber))) {
                    $(id).addClass("error");
                    return false;
                } else {
                    $(id).removeClass("error");
                }
            })
        });
    </script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.TextAreaField"*/-->
<div th:fragment="field-text-area(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <textarea th:field="*{__${component.name}__}" type="password" th:placeholder="${component.placeholder}"
              th:maxlength="${(component.maxLength gt 0) ? component.maxLength : _}" th:rows="${component.rows}"
              th:autocomplete="not ${component.disableAutoComplete}" th:required="${component.required}"
              th:autofocus="${component.autoFocus}" th:readonly="${component.readOnly}"></textarea>
    <span class="counter" style="display: none" th:attr="data-max-length=${component.maxLength}"></span>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:replace="~{:: field-text-script(${component})}"></script>
</div>


<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.ImageCaptchaField"*/-->
<div th:fragment="field-captcha-image(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <div class="captcha section">
        <input th:field="*{__${component.name}__}" th:placeholder="${component.placeholder}"
               th:autocomplete="not ${component.disableAutoComplete}" th:required="${component.required}"
               th:autofocus="${component.autoFocus}" th:readonly="${component.readOnly}"/>
        <a class="captcha link" href="#">
            <img th:src="@{${component.captchaUrl}}"/>
        </a>
    </div>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "";
            var captchaLink = $(id).find(".captcha.link");
            var image = $(captchaLink).find("img");

            $(captchaLink).on("click", function (e) {
                var src = $(image).attr("src");
                $(image).attr("src", function () {
                    var timestamp = (new Date()).valueOf();
                    if ((src.indexOf("?") >= 0)) {
                        src = src.substring(0, src.indexOf('?')) + "?timestamp=" + timestamp;
                    } else {
                        src = src + "?timestamp=" + timestamp;
                    }
                    return src;
                });
                e.preventDefault();
            });
        });
    </script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.PhoneCaptchaField"*/-->
<div th:fragment="field-captcha-phone(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <div class="captcha section">
        <div th:if="${#strings.isEmpty(component.phoneField)}" class="phone number section">
            <input th:id="|${component.name}-phone|" placeholder="请输入接受短信的手机号码"/>
        </div>
        <div class="phone captcha section">
            <input th:field="*{__${component.name}__}" th:placeholder="${component.placeholder}"
                   th:autocomplete="not ${component.disableAutoComplete}" th:required="${component.required}"
                   th:autofocus="${component.autoFocus}" th:readonly="${component.readOnly}"/>
            <button class="ui basic secondary captcha button" type="button">获取验证码</button>
        </div>
    </div>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "";
            var phoneField = /*[['#' + (${#strings.isEmpty(component.phoneField)} ? ${component.name} + '-phone' : ${component.phoneField})]]*/"";
            var button = $(id).find(".captcha.button");
            var input = $(id).find(".phone.captcha.section input");
            var targetUrl = /*[[${component.captchaUrl}]]*/"";
            var interval = /*[[${component.interval}]]*/"";

            $(phoneField).on("keyup", function () {
                $(id).removeClass("error");
                $(input).val("");
            });

            $(button).on("click", function () {
                var phoneNumber = $(phoneField).val();

                if (!(/^1[34578]\d{9}$/.test(phoneNumber))) {
                    $(id).addClass("error");
                    $(input).val("手机号格式不正确");
                    return false;
                }

                $(button).addClass("disabled loading");

                $.ajax(targetUrl, {
                    type: "POST",
                    data: {
                        phone: phoneNumber
                    },
                    success: function () {

                        $(button).removeClass("loading");

                        var duration = interval;

                        var timer = setInterval(function () {
                            $(button).text(duration + "秒后可重发");
                            duration--;
                            if (duration === 0) {
                                clearInterval(timer);
                                $(button).text("重新发送");
                                $(button).removeClass("disabled loading");
                            }
                        }, 1000);
                    },
                    error: function (requset) {
                        $(id).addClass("error");
                        $(button).removeClass("disabled loading");
                        $(button).text("重新发送");
                        $(input).val(requset.responseText);
                    }
                });
            });
        });
    </script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.AvatarField"*/-->
<div th:fragment="field-avatar(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <input th:field="*{__${component.name}__}" type="hidden"/>
    <input type="file" style="display: none" th:attr="data-max-size=${component.maxSize}"/>
    <label th:replace="~{:: field-label(${component})}"></label>
    <div class="avatar upload component">
        <div class="upload-box">
            <div class="ui progress-dimmer dimmer">
                <div class="ui text loader"></div>
            </div>
            <div class="ui error-dimmer dimmer">
                <div class="content">
                    <div class="center">
                        <p class="ui inverted red icon header">
                            <i class="warning circle icon"></i>
                            <span></span>
                        </p>
                    </div>
                </div>
            </div>
            <i class="plus large grey icon"></i>
        </div>
    </div>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "";
            var component = $(id).find(".upload-box");
            var input = $(id).find("input[type='hidden']");
            var file = $(id).find("input[type='file']");
            var maxSize = $(file).attr("data-max-size");
            var progressDimmer = $(component).find(".ui.progress-dimmer");
            var errorDimmer = $(component).find(".ui.error-dimmer");

            $(component).on("click", function (e) {
                $(file).click();
                e.stopPropagation();
            });

            $(file).on("change", function () {

                if (this.files.length > 0) {
                    var file = this.files[0];

                    if (file.size > 1024 * maxSize) {
                        $(errorDimmer).find(".ui.header span").text("图片大小不能超过" + maxSize + "KB");
                        $(errorDimmer).dimmer("show");
                        setTimeout(function () {
                            $(errorDimmer).dimmer("hide");
                        }, 3000);
                        return;
                    }

                    var formData = new FormData();
                    formData.append("file", file);

                    $(progressDimmer).dimmer("show");

                    $.ajax("/api/image/upload", {
                        xhr: function () {
                            var xhr = $.ajaxSettings.xhr();

                            if (xhr.upload) {
                                xhr.upload.addEventListener("progress", function (e) {
                                    if (e.lengthComputable) {
                                        var percentComplete = e.loaded / e.total;
                                        percentComplete = parseInt(percentComplete * 100);
                                        $(progressDimmer).find(".ui.text.loader").text(percentComplete + "%");
                                    }
                                }, false);
                            }

                            return xhr;
                        },
                        type: "POST",
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (response) {
                            $(input).val(response);
                            setImage();
                            $(progressDimmer).dimmer("hide");
                        },
                        error: function (response) {
                            $(progressDimmer).dimmer("hide");
                            $(errorDimmer).find(".ui.header span").text(response.responseText);
                            $(errorDimmer).dimmer("show");
                            setTimeout(function () {
                                $(errorDimmer).dimmer("hide");
                            }, 3000);
                        }
                    });
                }
            });

            setImage();

            function setImage() {
                if ($(input).val()) {
                    $(component).find("img,i.plus.icon").remove();
                    $(component).append($('<img class="avatar image" src="' + $(input).val() + '"/>'));
                }
            }
        });
    </script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.AlbumField"*/-->
<div th:fragment="field-album(component)"
     th:id="${component.id}" th:class="${component.getClassName()}">
    <input th:field="*{__${component.name}__}" type="hidden"/>
    <input type="file" style="display: none"
           th:attr="data-max-size=${component.maxSize},data-max-count=${component.maxCount}"/>
    <label th:replace="~{:: field-label(${component})}"></label>
    <div class="album upload component"></div>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "",
                component = $(id).find(".album.upload.component"),
                input = $(id).find("input[type='hidden']"),
                file = $(id).find("input[type='file']"),
                maxSize = $(file).attr("data-max-size"),
                maxCount = $(file).attr("data-max-count");

            refreshAlbumField();

            function refreshAlbumField() {
                $(component).empty();

                var items = $(input).val().split(",");

                $(items).each(function (index, item) {

                    if (item === "") {
                        return;
                    }

                    var value = item;

                    var root = $('<div class="image upload-box"></div>');
                    var deleteButton = $('<div class="ui baisc inverted grey link icon button"><i class="remove icon"></i></div>');
                    var dimmer = $('<div class="ui dimmer"><div class="content"><div class="center"></div></div></div>');
                    var image = $('<img class="album image" src="' + item + '"/>');

                    $(dimmer).find(".center").append(deleteButton);
                    $(root).append(dimmer).append(image);
                    $(component).append(root);

                    $(deleteButton).click(function () {

                        var newItems = [];

                        $(items).each(function (index, item) {
                            if (value !== item && value !== "") {
                                newItems.push(item);
                            }
                        });

                        $(input).val(newItems.join(","));

                        refreshAlbumField();
                    })
                });

                $(id).find(".image.upload-box").dimmer({on: "hover"});

                if (items.length < maxCount) {
                    var root = $('<div class="file upload-box"></div>');
                    var progressDimmer = $('<div class="ui progress-dimmer dimmer"><div class="ui text loader"></div></div>');
                    var errorDimmer = $('<div class="ui error-dimmer dimmer"><div class="content"><div class="center"><p class="ui inverted red icon header"><i class="warning circle icon"></i><span></span></p></div></div></div>');
                    var icon = $('<i class="plus grey icon"></i>');
                    $(root).append(progressDimmer).append(errorDimmer).append(icon);
                    $(component).append(root);

                    $(root).click(function (e) {
                        $(file).click();
                        e.stopPropagation();
                    });

                    $(file).off("change");
                    $(file).on("change", function () {

                        if (this.files.length > 0) {
                            var file = this.files[0];

                            if (file.size > 1024 * maxSize) {
                                $(errorDimmer).find(".ui.header span").text("图片大小不能超过" + maxSize + "KB");
                                $(errorDimmer).dimmer("show");
                                setTimeout(function () {
                                    $(errorDimmer).dimmer("hide");
                                }, 3000);
                                return;
                            }

                            var formData = new FormData();
                            formData.append("file", file);

                            $(progressDimmer).dimmer("show");

                            $.ajax("/api/image/upload", {
                                xhr: function () {
                                    var xhr = $.ajaxSettings.xhr();

                                    if (xhr.upload) {
                                        xhr.upload.addEventListener("progress", function (e) {
                                            if (e.lengthComputable) {
                                                var percentComplete = e.loaded / e.total;
                                                percentComplete = parseInt(percentComplete * 100);
                                                $(progressDimmer).find(".ui.text.loader").text(percentComplete + "%");
                                            }
                                        }, false);
                                    }

                                    return xhr;
                                },
                                type: "POST",
                                data: formData,
                                processData: false,
                                contentType: false,
                                success: function (response) {
                                    var items = $(input).val().split(",");
                                    if (items[0] === "") {
                                        $(input).val(response);
                                    } else {
                                        $(input).val($(input).val() + "," + response);
                                    }
                                    $(progressDimmer).dimmer("hide");
                                    refreshAlbumField();
                                },
                                error: function (response) {
                                    $(progressDimmer).dimmer("hide");
                                    $(errorDimmer).find(".ui.header span").text(response.responseText);
                                    $(errorDimmer).dimmer("show");
                                    setTimeout(function () {
                                        $(errorDimmer).dimmer("hide");
                                    }, 3000);
                                }
                            });
                        }
                    });
                }
            }
        });
    </script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.BooleanField"*/-->
<div th:fragment="field-boolean(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <div th:class="${component.getCheckboxClass()}">
        <input th:field="*{__${component.name}__}" type="checkbox"/>
        <label></label>
    </div>
    <script th:replace="~{:: field-common-script(${component})}"></script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.TextSelectionField"*/-->
<div th:fragment="field-selection-text(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <div th:class="${component.getDropdownClass()}">
        <input th:field="*{__${component.name}__}" type="hidden"/>
        <i class="dropdown icon"></i>
        <div class="default text" th:utext="${component.placeholder}"></div>
        <div class="menu">
            <div th:each="item : ${__${component.itemIndex}__}" class="item"
                 th:attr="data-value=${item.__${component.itemValueIndex}__}"
                 th:utext="${item.__${component.itemTextIndex}__}"></div>
        </div>
    </div>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "";
            var dropdown = $(id).find(".component.ui.dropdown");
            var dropdownConfig = /*[[${component.config}]]*/ {};

            $(dropdown).dropdown(dropdownConfig);
        });
    </script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.NumberField"*/-->
<div th:fragment="field-number(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <div class="component">
        <div class="content">
            <input th:field="*{__${component.name}__}" th:placeholder="${component.placeholder}"
                   th:autocomplete="not ${component.disableAutoComplete}" th:required="${component.required}"
                   th:autofocus="${component.autoFocus}" th:readonly="${component.readOnly}"
                   th:step="${component.step}" th:min="${component.min}" th:max="${component.max}"/>
            <span class="plus"><i class="angle up link icon"></i></span>
            <span class="minus"><i class="angle down link icon"></i></span>
        </div>
    </div>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "";
            var content = $(id).find(".component .content");
            var input = $(content).find("input");
            var plus = $(content).find(".plus");
            var minus = $(content).find(".minus");
            var step = Number.parseFloat($(input).attr("step"));
            var min = Number.parseFloat($(input).attr("min"));
            var max = Number.parseFloat($(input).attr("max"));

            $(plus).click(function () {
                var current = Number.parseFloat($(input).val());
                var nextValue = current + step;
                if (nextValue <= max) {
                    $(input).val(nextValue);
                    $(input).change();
                }
            });

            $(minus).click(function () {
                var current = Number.parseFloat($(input).val());
                var nextValue = current - step;
                if (nextValue >= min) {
                    $(input).val(nextValue);
                    $(input).change();
                }
            });

            $(input).change(function () {
                var current = Number.parseFloat($(this).val());

                if (isNaN(current)) {
                    $(id).addClass("error");
                    return;
                }

                if (current > max || current < min) {
                    $(id).addClass("error");
                    return;
                }

                $(id).removeClass("error");
            });
        });
    </script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.DynamicField"*/-->
<div th:fragment="field-dynamic(component)" th:with="items=*{__${component.name}__}"
     th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <div class="component">
        <table class="ui celled very compact unstackable center aligned table">
            <thead>
            <tr>
                <th th:each="head : ${component.itemHeaders}" th:utext="${head}"></th>
                <th>
                    <button class="ui tiny basic link icon button"
                            th:classappend="${#lists.size(items) ge component.maxCount} ? 'disabled' : ''" type="submit"
                            th:name="|add_${component.name}|" th:value="${true}">
                        <i class="plus icon"></i>
                    </button>
                </th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${#lists.isEmpty(items)}">
                <td th:colspan="${#lists.size(component.itemFields) + 1}">
                    <i class="info circle grey icon"></i> 暂无内容
                </td>
            </tr>
            <tr th:each="item : *{__${component.name}__}">
                <td th:if="${component.rawType}">
                    <div class="ui input">
                        <input th:field="*{__${component.name}__[__${itemStat.index}__]}"/>
                    </div>
                </td>
                <th:block th:unless="${component.rawType}">
                    <td th:each="field : ${component.itemFields}">
                        <div class="ui input">
                            <input th:field="*{__${component.name}__[__${itemStat.index}__].__${field}__}"/>
                        </div>
                    </td>
                </th:block>
                <td>
                    <button class="ui tiny basic link icon button" type="submit"
                            th:name="|remove_${component.name}|" th:value="${itemStat.index}">
                        <i class="remove icon"></i>
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <script th:replace="~{:: field-common-script(${component})}"></script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.HtmlField"*/-->
<div th:fragment="field-html(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <input type="hidden" class="html-content" th:field="*{__${component.name}__}"/>
    <input type="hidden" class="quill-content" th:field="*{__|${component.name}Quill|__}"/>
    <input type="file" class="quill-image" style="display: none" accept="image/png, image/gif, image/jpeg, image/jpg"/>
    <div class="component">
        <div class="quill-container">
            <div class="quill-editor"></div>
        </div>
    </div>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "";
            $(/*[[|#${component.id}|]]*/ "").quill();
        });
    </script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.DateTimeField"*/-->
<div th:fragment="field-date-time(component)" th:id="${component.id}" th:class="${component.getClassName()}">
    <label th:replace="~{:: field-label(${component})}"></label>
    <div class="component">
        <div class="ui calendar">
            <div class="ui input left icon">
                <i th:if="${component.type.toString() eq 'time'}" class="time icon"></i>
                <i th:unless="${component.type.toString() eq 'time'}" class="calendar icon"></i>
                <input th:field="*{__${component.name}__}" type="text" th:placeholder="${component.placeholder}"/>
            </div>
        </div>
    </div>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "";
            var calendar = $(id).find(".ui.calendar");
            var minDateTime = /*[[${component.minDate ne null ? component.minDate.getTime() : null}]]*/ null;
            var maxDateTime = /*[[${component.maxDate ne null ? component.maxDate.getTime() : null}]]*/ null;

            calendar.calendar({
                type: /*[[${component.type.toString()}]]*/ "",
                today: /*[[${component.showToday}]]*/ "",
                ampm: /*[[${component.showAmPm}]]*/ "",
                disableYear: /*[[${component.disableYear}]]*/ "",
                disableMonth: /*[[${component.disableMonth}]]*/ "",
                disableMinute: /*[[${component.disableMinute}]]*/ "",
                minDate: minDateTime ? new Date(minDateTime) : null,
                maxDate: maxDateTime ? new Date(maxDateTime) : null,
                popupOptions: {
                    position: "bottom right",
                    lastResort: 'bottom right'
                },
                text: {
                    days: ['日', '一', '二', '三', '四', '五', '六'],
                    months: ['一月份', '二月份', '三月份', '四月份', '五月份', '六月份', '七月份', '八月份', '九月份', '十月份', '十一月份', '十二月份'],
                    monthsShort: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                    today: '今天',
                    now: '现在',
                    am: '上午',
                    pm: '下午'
                },
                formatter: {
                    date: function (date, settings) {
                        if (!date) return '';
                        var day = date.getDate();
                        var month = date.getMonth() + 1;
                        var year = date.getFullYear();
                        return year + '-' + month + '-' + day;
                    }
                }
            });
        });
    </script>
</div>

<!--/*@thymesVar id="component" type="com.qxcmp.framework.web.view.modules.form.field.FileUploadField"*/-->
<div th:fragment="field-file-upload(component)"
     th:id="${component.id}" th:class="${component.getClassName()}">
    <input th:field="*{__${component.name}__}" type="hidden"/>
    <input type="file" style="display: none"
           th:attr="data-max-size=${component.maxSize},data-max-count=${component.maxCount}"/>
    <label th:replace="~{:: field-label(${component})}"></label>
    <div class="component">
        <div class="ui mini black button" th:utext="${component.text}"></div>
        <span class="message"></span>
        <div class="ui selection list">

        </div>
    </div>
    <script th:replace="~{:: field-common-script(${component})}"></script>
    <script th:inline="javascript">
        $(document).ready(function () {
            var id = /*[[|#${component.id}|]]*/ "",
                input = $(id).find("input[type='hidden']"),
                file = $(id).find("input[type='file']"),
                maxSize = $(file).attr("data-max-size"),
                maxCount = $(file).attr("data-max-count"),
                button = $(id).find(".component .ui.button"),
                message = $(id).find(".component .message"),
                list = $(id).find(".component .ui.list");

            function createItem(file) {
                var fileSize = file.size;
                var fileSizeText = parseFloat((fileSize / 1024)).toFixed(2) + "KB";

                if (fileSizeText > 1024) {
                    fileSizeText = parseFloat((fileSize / 1024)).toFixed(2) + "MB";
                }

                if (fileSizeText > 1024) {
                    fileSizeText = parseFloat((fileSize / 1024)).toFixed(2) + "GB";
                }

                return $('<div class="item"><i class="file black icon"></i><div class="content"><div class="header">' + file.name + '</div><div class="description">' + fileSizeText + '</div></div><div class="action"><i class="remove grey icon"></i></div></div></div>')
            }

            function calculateValue() {
                var values = [];
                $(list).find(".item").each(function (index, item) {
                    var key = $(item).attr("data-key");
                    if (key) {
                        values.push(key);
                    }
                });
                $(input).val(values.join(","));
            }

            $(button).click(function (e) {
                $(file).click();
                e.stopPropagation();
            });

            $(file).on("change", function () {

                if ($(list).find(".item").length >= maxCount) {
                    $(message).text("最多只能上传" + maxCount + "个文件");
                    return;
                }

                if (this.files.length > 0) {
                    var file = this.files[0];

                    if (file.size > 1024 * maxSize) {
                        $(message).text("图片大小不能超过" + maxSize + "KB");
                        return;
                    } else {
                        $(message).text("");
                    }

                    var item = createItem(file);
                    $(item).find(".remove.icon").click(function () {
                        $(item).remove();
                        calculateValue();
                    });
                    $(list).append(item);

                    var formData = new FormData();
                    formData.append("file", file);

                    $.ajax("/api/file/upload", {
                        xhr: function () {
                            var xhr = $.ajaxSettings.xhr();

                            if (xhr.upload) {
                                xhr.upload.addEventListener("progress", function (e) {
                                    if (e.lengthComputable) {
                                        var percentComplete = e.loaded / e.total;
                                        percentComplete = parseInt(percentComplete * 100);
                                        //$(progressDimmer).find(".ui.text.loader").text(percentComplete + "%");
                                    }
                                }, false);
                            }

                            return xhr;
                        },
                        type: "POST",
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (response) {
                            $(item).attr("data-key", response);
                            calculateValue();
                        },
                        error: function (response) {
                            $(message).text(response.responseText);
                        }
                    });
                }
            });
        });
    </script>
</div>
</body>
</html>